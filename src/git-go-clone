#!/usr/bin/env bash

set -e

declare SCRIPT_PATH=$(realpath "$(dirname $0)")

# Source the script to test
source "$(realpath ${SCRIPT_PATH}/functions/remote_to_path.sh)"

# Function to display usage information
usage() {
    echo "Usage: $0 [options] <repository-url>"
    echo "Options:"
    echo "  -h, --help                   Display this help message"
    echo "  -d, --dry-run                Print the repository URL without cloning"
    exit 1
}

OPTIONS=""
DRY_RUN=false

# Parse command-line arguments
while [[ "$#" -gt 0 ]]; do
    case $1 in
        -h|--help)
            usage
            ;;
        -d|--dry-run)
            DRY_RUN=true
            ;;
        *)
            if [[ "$1" == -* ]]; then
                OPTIONS="$OPTIONS $1"
            elif [ -z "$REPO_URL" ]; then
                REPO_URL="$1"
            else
                echo "Unknown parameter passed: $1"
                usage
            fi
            ;;
    esac
    shift
done

# Check if repository URL is provided
if [ -z "$REPO_URL" ]; then
    echo "Error: Repository URL is required."
    usage
fi

# Handle dry-run option
if [ "$DRY_RUN" = true ]; then
    echo "Dry run: Repository URL is $REPO_URL"
    echo "git clone ${OPTIONS} ${REPO_URL}"
    exit 0
fi

# Clone the repository with options
git clone $OPTIONS "$REPO_URL" || {
    echo "Error: Failed to clone repository."
    exit 1
}

echo "Successfully cloned repository: $REPO_URL"
